<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns="http://www.liquibase.org/xml/ns/dbchangelog">


    <changeSet author="sevdokimov" id="040320201233-1">

        <comment>Create user table</comment>

        <sql stripComments="true" splitStatements="true"
             dbms="mysql">
            CREATE TABLE user(
                    id BIGINT NOT NULL AUTO_INCREMENT,
                    login VARCHAR(50) NOT NULL,
                    password VARCHAR(255) NOT NULL,
                    PRIMARY KEY (id)
            );
            CREATE TABLE role(
                id BIGINT NOT NULL AUTO_INCREMENT,
                role_name VARCHAR(50) NOT NULL,
                PRIMARY KEY (id)
            );

            CREATE TABLE user_role (
                user_id BIGINT NOT NULL,
                role_id BIGINT NOT NULL,

            FOREIGN KEY (user_id) REFERENCES user (id),
            FOREIGN KEY (role_id) REFERENCES role (id),

            UNIQUE (user_id, role_id)
            );

        </sql>

    </changeSet>

    <changeSet author="sevdokimov" id="040320201233-2">

        <comment>Insert test values into user and auth tables</comment>

        <sql stripComments="true" splitStatements="true"
             dbms="mysql">
            INSERT INTO USER(id, login, password) values (
                1, 'admin', '8c6976e5b5410415bde908bd4dee15dfb167a9c873fc4bb8a81f6f2ab448a918'
            );
            INSERT INTO role (id,  role_name) values (
                1, 'USER_ADMIN'
            );
            INSERT INTO role (id,  role_name) values (
                2, 'USER_USER'
            );
            INSERT INTO user_role (user_id,  role_id) values (
            1, 1
            );
        </sql>

    </changeSet>

</databaseChangeLog>